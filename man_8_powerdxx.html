<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>powerd++: Manual powerd++(8)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">powerd++
   &#160;<span id="projectnumber">0.4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Manual powerd++(8) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><pre>
powerd++(8)             FreeBSD System Manager's Manual            powerd++(8)</pre><pre><b>NAME</b>
     <b>powerd++</b> – CPU clock speed daemon</pre><pre><b>SYNOPSIS</b>
     <b>powerd++</b> <b>-h</b>
     <b>powerd++</b> [<b>-vf</b>] [<b>-a</b> <u>mode</u>] [<b>-b</b> <u>mode</u>] [<b>-n</b> <u>mode</u>] [<b>-m</b> <u>freq</u>] [<b>-M</b> <u>freq</u>]
              [<b>-F</b> <u>freq:freq</u>] [<b>-A</b> <u>freq:freq</u>] [<b>-B</b> <u>freq:freq</u>] [<b>-H</b> <u>temp:temp</u>]
              [<b>-p</b> <u>ival</u>] [<b>-s</b> <u>cnt</u>] [<b>-P</b> <u>file</u>]</pre><pre><b>DESCRIPTION</b>
     The <b>powerd++</b> daemon monitors the system load and adjusts the CPU clock
     speed accordingly.  It is a drop-in replacement for powerd(8) and
     supports two modes of operation, a load feedback control loop or fixed
     frequency operation.</pre><pre>   <b>ARGUMENTS</b>
     The following argument types can be given:</pre><pre>     <u>mode</u>    The mode is either a <u>load</u> target or a fixed <u>freq</u>.  The powerd(8)
             modes are interpreted as follows:
             maximum, max
                     Use the highest clock frequency.
             minimum, min
                     Use the lowest clock frequency.
             adaptive, adp
                     A target load of 0.5 (50%).
             hiadaptive, hadp
                     A target load of 0.375 (37.5%).</pre><pre>             If a scalar number is given, it is interpreted as a load.</pre><pre>     <u>load</u>    A load is either a fraction in the range [0.0, 1.0] or a
             percentage in the range [0%, 100%].</pre><pre>     <u>freq</u>    A clock frequency consists of a number and a frequency unit.
                   Hz, KHz, MHz, GHz, THz
             The unit is not case sensitive, if omitted MHz are assumed for
             compatibility with powerd(8).</pre><pre>     <u>temp</u>    A temperature consisting of a number and a temperature unit.
             Supported units are:
                   C, K, F, R
             These units stand for deg. Celsius, Kelvin, deg. Fahrenheit and
             deg. Rankine. A value without a unit is treated as deg. Celsius.</pre><pre>     <u>ival</u>    A time interval can be given in seconds or milliseconds.
                   s, ms
             An interval without a unit is treated as milliseconds.</pre><pre>     <u>cnt</u>     A positive integer.</pre><pre>     <u>file</u>    A file name.</pre><pre>   <b>OPTIONS</b>
     The following options are supported:</pre><pre>     <b>-h</b>, <b>&ndash;help</b>
             Show usage and exit</pre><pre>     <b>-v</b>, <b>&ndash;verbose</b>
             Be verbose and produce initial diagnostics on <u>stderr</u>.</pre><pre>     <b>-f</b>, <b>&ndash;foreground</b>
             Stay in foreground, produce an event log on <u>stdout</u>.</pre><pre>     <b>-a</b>, <b>&ndash;ac</b> <u>mode</u>
             Mode to use while the AC power line is connected (default hadp).</pre><pre>     <b>-b</b>, <b>&ndash;batt</b> <u>mode</u>
             Mode to use while battery powered (default adp).</pre><pre>     <b>-n</b>, <b>&ndash;unknown</b> <u>mode</u>
             Mode to use while the power line state is unknown (default hadp).</pre><pre>     <b>-m</b>, <b>&ndash;min</b> <u>freq</u>
             The lowest CPU clock frequency to use (default 0Hz).</pre><pre>     <b>-M</b>, <b>&ndash;max</b> <u>freq</u>
             The highest CPU clock frequency to use (default 1THz).</pre><pre>     <b>&ndash;min-ac</b> <u>freq</u>
             The lowest CPU clock frequency to use on AC power.</pre><pre>     <b>&ndash;max-ac</b> <u>freq</u>
             The highest CPU clock frequency to use on AC power.</pre><pre>     <b>&ndash;min-batt</b> <u>freq</u>
             The lowest CPU clock frequency to use on battery power.</pre><pre>     <b>&ndash;max-batt</b> <u>freq</u>
             The highest CPU clock frequency to use on battery power.</pre><pre>     <b>-F</b>, <b>&ndash;freq-range</b> <u>freq:freq</u>
             A pair of frequency values representing the minimum and maximum
             CPU clock frequency.</pre><pre>     <b>-A</b>, <b>&ndash;freq-range-ac</b> <u>freq:freq</u>
             A pair of frequency values representing the minimum and maximum
             CPU clock frequency on AC power.</pre><pre>     <b>-B</b>, <b>&ndash;freq-range-batt</b> <u>freq:freq</u>
             A pair of frequency values representing the minimum and maximum
             CPU clock frequency on battery power.</pre><pre>     <b>-H</b>, <b>&ndash;hitemp-range</b> <u>temp:temp</u>
             Set the high to critical temperature range, enables temperature
             based throttling.</pre><pre>     <b>-p</b>, <b>&ndash;poll</b> <u>ival</u>
             The polling interval that is used to take load samples and update
             the CPU clock (default 0.5s).</pre><pre>     <b>-s</b>, <b>&ndash;samples</b> <u>cnt</u>
             The number of load samples to use to calculate the current load.
             The default is 4.</pre><pre>     <b>-P</b>, <b>&ndash;pid</b> <u>file</u>
             Use an alternative pidfile, the default is <u>/var/run/powerd.pid</u>.
             The default ensures that powerd(8) and <b>powerd++</b> are not run
             simultaneously.</pre><pre>     <b>-i</b>, <b>-r</b> <u>load</u>
             Legacy arguments from powerd(8) not applicable to <b>powerd++</b> and
             thus ignored.</pre><pre><b>SERVICE</b>
     The <b>powerd++</b> daemon can be run as an rc(8) service. Add the following
     line to rc.conf(5):
           powerdxx_enable="YES"
     Command line arguments can be set via <u>powerdxx</u><b><u>_</u></b><u>flags</u>.</pre><pre><b>TOOLS</b>
     The loadrec(1) and loadplay(1) tools offer the possibility to record
     system loads and replay them.</pre><pre><b>IMPLEMENTATION</b> <b>NOTES</b>
     This section describes the operation of <b>powerd++</b>.</pre><pre>     Both powerd(8) and <b>powerd++</b> have in common, that they work by polling
     kern.cp_times via sysctl(3), which is an array of the accumulated loads
     of every core. By subtracting the last cp_times sample the loads over the
     polling interval can be determined. This information is used to set a new
     CPU clock frequency by updating dev.cpu.0.freq.</pre><pre>   <b>Initialisation</b>
     After parsing command line arguments <b>powerd++</b> assigns a clock frequency
     controller to every core. I.e. cores are grouped by a common
     dev.cpu.%d.freq handle that controls the clock for all of them. Due to
     limitations of cpufreq(4) dev.cpu.0.freq is the controlling handle for
     all cores, even across multiple CPUs. However <b>powerd++</b> is not built with
     that assumption and per CPU, core or thread controls will work as soon as
     the hardware and kernel support them.</pre><pre>     In the next initialisation stage the available frequencies for every core
     group are determined to set appropriate lower and upper boundaries. This
     is a purely cosmetic measure and used to avoid unnecessary frequency
     updates. The controlling algorithm does not require this information, so
     failure to do so will only be reported (non-fatally) in verbose mode.</pre><pre>     Unless the <b>-H</b> option is given, the initialisation checks for a critical
     temperature source. If one is found temperature throttling is implicitly
     turned on, causing throttling to start 10 deg. Celsius below the critical
     temperature.</pre><pre>     So far the sysctl(3) dev.cpu.%d.coretemp.tjmax is the only supported
     critical temperature source.</pre><pre>   <b>Detaching</b> <b>From</b> <b>the</b> <b>Terminal</b>
     After the initialisation phase <b>powerd++</b> prepares to detach from the
     terminal. The first step is to acquire a lock on the pidfile. Afterwards
     all the frequencies are read and written as a last opportunity to fail.
     After detaching from the terminal the pidfile is written and the daemon
     goes into frequency controlling operation until killed by a signal.</pre><pre>   <b>Load</b> <b>Control</b> <b>Loop</b>
     The original powerd(8) uses a hysteresis to control the CPU frequency.
     I.e. it determines the load over all cores since taking the last sample
     (the summary load during the last polling interval) and uses a lower and
     an upper load boundary to decide whether it should update the frequency
     or not.</pre><pre>     <b>powerd++</b> has some core differences. It can take more than two samples
     (four by default), this makes it more robust against small spikes in
     load, while retaining much of its ability to quickly react to sudden
     surges in load.  Changing the number of samples does not change the
     runtime cost of running <b>powerd++</b>.</pre><pre>     Instead of taking the sum of all loads, the highest load within the core
     group is used to decide the next frequency target. Like with powerd(8)
     this means, that high load on a single core will cause an increase in the
     clock frequency. Unlike powerd(8) it also means that moderate load over
     all cores allows a decrease of the clock frequency.</pre><pre>     The <b>powerd++</b> daemon steers the clock frequency to match a load target,
     e.g. if there was a 25% load on 2 GHz and the load target was 50%, the
     frequency would be set to 1 GHz.</pre><pre>   <b>Temperature</b> <b>Based</b> <b>Throttling</b>
     If temperature based throttling is active and the temperature is above
     the high temperature boundary (the critical temperature minus 10 deg.
     Celsius by default), the core clock is limited to a value below the
     permitted maximum. The limit depends on the remaining distance to the
     critical temperature.</pre><pre>     Thermal throttling ignores user-defined frequency limits, i.e. when using
     <b>-F</b>, <b>-B</b>, <b>-A</b> or <b>-m</b> to prevent the clock from going unreasonably low,
     sufficient thermal load may cause <b>powerd++</b> to select a clock frequency
     below the user provided minimum.</pre><pre>   <b>Termination</b> <b>and</b> <b>Signals</b>
     The signals HUP and TERM cause an orderly shutdown of <b>powerd++</b>.  An
     orderly shutdown means the pidfile is removed and the clock frequencies
     are restored to their original values.</pre><pre><b>FILES</b>
     <u>/var/run/powerd.pid</u> Common pidfile with powerd(8).
     <u>/usr/local/etc/rc.d/powerdxx</u> Service file, enable in rc.conf(5).</pre><pre><b>EXAMPLES</b>
     Run in foreground, minimum clock frequency 800 MHz:
           powerd++ -fm800</pre><pre>     Report configuration before detaching into the background:
           powerd++ -v</pre><pre>     Target 75% load on battery power and run at 2.4 GHz on AC power:
           powerd++ -b .75 -a 2.4ghz</pre><pre>     Target 25% load on AC power:
           powerd++ -a 25%</pre><pre>     Use the same load sampling powerd(8) does:
           powerd++ -s2 -p.25s</pre><pre>     Limit CPU clock frequencies to a range from 800 MHz to 1.8 GHz:
           powerd++ -F800:1.8ghz</pre><pre><b>DIAGNOSTICS</b>
     The <b>powerd++</b> daemon exits 0 on receiving an INT or TERM signal, and &gt;0 if
     an error occurs.</pre><pre><b>COMPATIBILITY</b>
     So far <b>powerd++</b> requires ACPI to detect the current power line state.</pre><pre><b>SEE</b> <b>ALSO</b>
     cpufreq(4), powerd(8), loadrec(1), loadplay(1)</pre><pre><b>AUTHORS</b>
     Implementation and manual by Dominic Fandrey ⟨kami@freebsd.org⟩</pre><pre>FreeBSD 12.0-STABLE               9 May, 2017              FreeBSD 12.0-STABLE
</pre> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
